<!DOCTYPE html>
<html>
  <head>
    <title>Twittler</title>

    <link rel="stylesheet" href="css/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">

    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="http://underscorejs.org/underscore.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  </head>

  <body>
    <header>
      <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container-fluid">
          <div class="navbar-header">
            <a class="navbar-brand" href="#">
              <img alt="Twittler" src="">
            </a>
          </div>

          <form class="navbar-form navbar-left" role="search">
            <div class="form-group">
              <input type="text" class="form-control" placeholder="Search">
            </div>
            <button type="submit" class="btn btn-default" aria-label="Search">
              <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
            </button>
          </form>

          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home<span class="sr-only">(current)</span></a></li>
            <li><a href="#">Profile</a></li>
            <li><a href="#">Messages</a></li>
          </ul>

          <ul class="nav navbar-nav navbar-right">
            <li>
              <button type="button" class="btn btn-default navbar-btn">
                <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
              </button>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">jwdomingo<span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="#">Profile</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="#">Lists</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="#">Help</a></li>
                <li><a href="#">Keyboard Shortcuts</a></li>
                <li><a href="#">Twitter Ads</a></li>
                <li><a href="#">Analytics</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="#">Settings</a></li>
                <li><a href="#">Log Out</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </nav>
    </header>
    <div class="container">
      <div class="row">
        <div class="col-md-2"></div>
        <div id="script-body" class="col-md-8"></div>
        <div class="col-md-2"></div>
      </div>
    </div>

    <script>

      $(document).ready(function(){
        var $body = $('#script-body');

        var index = streams.home.length - 1;

        /////////////////////
        // CREATE TWITTLES //
        /////////////////////

        var makeTwittle = function(twittle) {
          var $tweet = $('<div class="tweet"></div>');

          var $user =  $('<a></a>');
          $user.text('@' + twittle.user);

          var $timestamp = $('<time></time>');
          $timestamp.text(twittle.created_at);

          var $message = $('<p></p>');
          $message.text(twittle.message);

          return $tweet.append($user)
                       .append($timestamp)
                       .append($message);
        };

        ///////////////////////////////
        // INITIALIZE FIRST TWITTLES //
        ///////////////////////////////

        while(index >= 0){
          var tweet = streams.home[index];

          makeTwittle(tweet).appendTo($body);
          index--;
        }

        ////////////////////////////
        // LIVE PUSH TWITTLE FEED //
        ////////////////////////////

        var newNumTweets = 0;
        var $newMsg = $('<div id="viewNew"></div>');
        var $par = $('<p class="text-center"></p>');

        Array.observe(streams.home, function(changes) {
          _.each(changes, function(change) {
            // var oldNumTweets = $('.tweet').length;
            // console.log('tweet length:'), oldNumTweets;
            // console.log('stream.home:', streams.home.lengtj)
            newNumTweets++;

            if (newNumTweets) {
              $par.text('View ' + newNumTweets + ' new Twittle' + ((newNumTweets > 1) ? 's' : ''));
              $newMsg.append($par).prependTo($body);
              console.log('View ' + newNumTweets + ' new Twittle' + ((newNumTweets > 1) ? 's' : ''));
            }
          //var tweet = streams.home[change.index]
          //makeTwittle(tweet).prependTo($body);
         });
        });
      });

    </script>
  </body>
</html>
